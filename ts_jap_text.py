import tkinter as tk
from tkinter import filedialog
import os
from opencc import OpenCC

# 置換辞書
char_map = {
  "亞": "亜",
  "亚": "亜",
  "战": "戦",
  "戰": "戦",
  "颜": "顔",
  "顏": "顔",
  "区": "区",
  "區": "区",
  "学": "学",
  "學": "学",
  "写": "写",
  "寫": "写",
  "号": "号",
  "號": "号",
  "参": "参",
  "參": "参",
  "国": "国",
  "國": "国",
  "独": "独",
  "獨": "独",
  "税": "税",
  "稅": "税",
  "内": "内",
  "內": "内",
  "数": "数",
  "數": "数",
  "医": "医",
  "醫": "医",
  "会": "会",
  "會": "会",
  "体": "体",
  "體": "体",
  "当": "当",
  "當": "当",
  "宝": "宝",
  "寶": "宝",
  "灯": "灯",
  "燈": "灯",
  "松": "松",
  "鬆": "松",
  "点": "点",
  "點": "点",
  "台": "台",
  "臺": "台",
  "湾": "湾",
  "灣": "湾",
  "称": "称",
  "稱": "称",
  "争": "争",
  "爭": "争",
  "声": "声",
  "聲": "声",
  "党": "党",
  "黨": "党",
  "属": "属",
  "屬": "属",
  "礼": "礼",
  "禮": "礼",
  "恋": "恋",
  "戀": "恋",
  "御": "御",
  "禦": "御",
  "欧": "欧",
  "歐": "欧",
  "万": "万",
  "萬": "万",
  "条": "条",
  "條": "条",
  "札": "札",
  "劄": "札",
  "乱": "乱",
  "亂": "乱",
  "胆": "胆",
  "膽": "胆",
  "断": "断",
  "斷": "断",
  "触": "触",
  "觸": "触",
  "苹": "苹",
  "蘋": "苹",
  "群": "群",
  "羣": "群",
  "担": "担",
  "擔": "担",
  "着": "着",
  "著": "着",
  "铁": "鉄",
  "鐵": "鉄",
  "产": "産",
  "对": "対",
  "對": "対",
  "证": "証",
  "證": "証",
  "觉": "覚",
  "覺": "覚",
  "单": "単",
  "單": "単",
  "险": "険",
  "險": "険",
  "关": "関",
  "關": "関",
  "边": "辺",
  "邊": "辺",
  "价": "価",
  "價": "価",
  "值": "値",
  "发": "発",
  "發": "発",
  "卖": "売",
  "賣": "売",
  "继": "継",
  "繼": "継",
  "续": "続",
  "續": "続",
  "览": "覧",
  "覽": "覧",
  "阅": "閲",
  "閱": "閲",
  "读": "読",
  "讀": "読",
  "气": "気",
  "氣": "気",
  "儿": "児",
  "兒": "児",
  "龙": "竜",
  "龍": "龍",
  "户": "戸",
  "戶": "戸",
  "乡": "郷",
  "鄉": "郷",
  "广": "広",
  "廣": "広",
  "脑": "脳",
  "腦": "脳",
  "变": "変",
  "變": "変",
  "处": "処",
  "處": "処",
  "厅": "庁",
  "廳": "庁",
  "围": "囲",
  "圍": "囲",
  "带": "帯",
  "帶": "帯",
  "冰": "氷",
  "绝": "絶",
  "联": "連",
  "聯": "連",
  "复": "複",
  "压": "圧",
  "壓": "圧",
  "县": "県",
  "縣": "県",
  "验": "験",
  "驗": "験",
  "择": "択",
  "擇": "択",
  "录": "録",
  "錄": "録",
  "营": "営",
  "營": "営",
  "图": "図",
  "圖": "図",
  "画": "画",
  "畫": "画",
  "恶": "悪",
  "惡": "悪",
  "团": "団",
  "團": "団",
  "综": "総",
  "綜": "総",
  "两": "両",
  "兩": "両",
  "满": "満",
  "滿": "満",
  "经": "経",
  "經": "経",
  "济": "済",
  "濟": "済",
  "齐": "斉",
  "齊": "斉",
  "圈": "圏",
  "杂": "雑",
  "雜": "雑",
  "乐": "楽",
  "樂": "楽",
  "叠": "畳",
  "疊": "畳",
  "櫻": "桜",
  "樱": "桜",
  "严": "厳",
  "嚴": "厳",
  "厂": "場",
  "廠": "場",
  "劳": "労",
  "勞": "労",
  "稳": "穏",
  "穩": "穏",
  "烟": "煙",
  "煙": "煙",
  "转": "転",
  "斋": "斎",
  "齋": "斎",
  "归": "帰",
  "歸": "帰",
  "晓": "暁",
  "曉": "暁",
  "实": "実",
  "實": "実",
  "滞": "滞",
  "滯": "滞",
  "残": "残",
  "殘": "残",
  "坏": "壊",
  "壞": "壊",
  "淺": "浅",
  "擴": "拡",
  "澤": "沢",
  "礦": "鉱",
  "權": "権",
  "歷": "歴",
  "增": "増",
  "黑": "黒",
  "曾": "曽",
  "查": "査",
  "慘": "惨",
  "產": "産",
  "豐": "豊",
  "總": "総",
  "举": "挙",
  "舉": "挙",
  "冈": "岡",
  "崗": "岡",
  "净": "浄",
  "淨": "浄",
  "剂": "剤",
  "劑": "剤",
  "剑": "剣",
  "劍": "剣",
  "劝": "勧",
  "勸": "勧",
  "娱": "娯",
  "娛": "娯",
  "恼": "悩",
  "惱": "悩",
  "择": "択",
  "擇": "択",
  "湿": "湿",
  "濕": "湿",
  "满": "満",
  "滿": "満",
  "览": "覧",
  "覽": "覧",
  "轻": "軽",
  "輕": "軽",
  "黃": "黄",
  "齿": "歯",
  "齒": "歯",
  "怀": "懐",
  "懷": "懐",
  "弹": "弾",
  "彈": "弾",
  "将": "将",
  "將": "将",
}

replace_count = 0
cc = OpenCC('s2t')  # 簡体を繁体に変換

def replace_chars_in_text(text, mapping):
    global replace_count
    # 第一步：簡体 → 繁体
    text = cc.convert(text)

    # 第二步：繁体 → 日本語用字
    for old, new in mapping.items():
        count = text.count(old)
        if count > 0:
            replace_count += count
            text = text.replace(old, new)
    return text

def process_text_file(file_path):
    global replace_count
    replace_count = 0
    with open(file_path, 'r', encoding='utf-8') as f:
        content = f.read()

    new_content = replace_chars_in_text(content, char_map)

    # 元のファイルに上書きする
    with open(file_path, 'w', encoding='utf-8') as f:
        f.write(new_content)

    return replace_count

def choose_text_file():
    root = tk.Tk()
    root.withdraw()
    return filedialog.askopenfilename(
        title="修正するテキストファイルを選択して",
        filetypes=[("All files", "*.*")]
    )

# 主プログラム
input_path = choose_text_file()
if input_path:
    count = process_text_file(input_path)
    print(f"✅ 原始ファイルが修正されました：{input_path}")
    print(f"合計 {count} 文字が変更されました")
else:
    print("❌ ファイルが選択されていません")
